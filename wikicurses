#! /usr/bin/env python3

import argparse

import wikicurses.ui as ui
from wikicurses.wiki import Wiki

base_url = "http://en.wikipedia.org/w/api.php?"

parser = argparse.ArgumentParser(description =
                                    "A simple curses interface for accessing Wikipedia.")

parser.add_argument('search',
                    nargs = '?',
                    default = '',
                    help = "Page to search for on Wikipedia")

group = parser.add_mutually_exclusive_group()
group.add_argument('-d', '--today',
                    action = 'store_const',
                    const = 'onthisday',
                    help='Display URLs for the "On this day" pages')
group.add_argument('-f', '--featured',
                    action = 'store_const',
                    const = 'featured',
                    help = 'Display the featured articles URLs')
group.add_argument('-p', '--picture',
                    action = 'store_const',
                    const = 'potd',
                    help='Display URLs for the "Picture of the day" pages')

args = parser.parse_args()
wiki = Wiki(base_url)

if args.search :
    article = wiki.search(args.search)
    ui.setContent(article.title, article.content)
else:
    feed = args.featured or args.picture or args.today
    feed = feed or 'featured'
    title = {'onthisday': 'On this Day',
            'featured': 'Featured Articles',
            'potd': 'Picture of the Day'
            }[feed]
    content = wiki.get_featured_feed(feed)
    ui.setContent(title, content)
ui.loop.run()

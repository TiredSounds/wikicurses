#! /usr/bin/env python3

import argparse

import wikicurses.ui as ui
from wikicurses.wiki import Wiki

parser = argparse.ArgumentParser(
        description="A simple curses interface for accessing Wikipedia.")

parser.add_argument('search',
                    nargs = '?',
                    default = '',
                    help = "page to search for")
parser.add_argument('--wiki',
                    default = "http://en.wikipedia.org/w/api.php",
                    help='wiki api url')

group = parser.add_mutually_exclusive_group()
group.add_argument('-d', '--today',
                    action = 'store_const',
                    const = 'onthisday',
                    help='list "On This Day" pages')
group.add_argument('-f', '--featured',
                    action = 'store_const',
                    const = 'featured',
                    help = 'show featured articles')
group.add_argument('-p', '--picture',
                    action = 'store_const',
                    const = 'potd',
                    help='show pictures of the day')

args = parser.parse_args()
ui.wiki = Wiki(args.wiki)

if args.search:
    ui.setContent(ui.wiki.search(args.search))
else:
    # Show featured by default
    feed = args.featured or args.picture or args.today or 'featured'
    ui.setContent(ui.wiki.get_featured_feed(feed))
ui.loop.run()

